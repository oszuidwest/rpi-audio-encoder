<!DOCTYPE html>
<html lang="en">
<!--
  ZuidWest FM Encoder - Web Interface

  Single-page application for real-time audio monitoring and encoder control.
  Built with Alpine.js for reactive state management.

  Views:
    - Dashboard: Live VU meter, encoder status, output management
    - Settings: Audio input, silence detection, alerts, about info
    - Add Output: Form for creating new stream outputs

  State Management:
    - Alpine.js component: encoderApp() defined in app.js
    - View switching via 'view' property: 'dashboard' | 'settings' | 'add-output'
    - WebSocket at /ws for real-time updates

  File Dependencies:
    - style.css: All styling and animations
    - icons.js: SVG icon definitions (window.icons)
    - app.js: Alpine.js application logic
    - alpine.js: Alpine.js framework

  @see app.js for state management and WebSocket handling
  @see style.css for component styling
  @see icons.js for SVG icon reference
-->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Web interface for Raspberry Pi audio encoder - stream audio to SRT servers">
    <title>ZuidWest FM Encoder</title>
    <link rel="canonical" href="/">
    <link rel="stylesheet" href="/style.css">
    <script src="/alpine.min.js" defer="defer"></script>
</head>
<body x-data="encoderApp()" x-cloak>
    <!-- Dark mode detection - syncs with system preference
         Sets --color-scheme CSS variable for theme-aware styling
         Listens for system preference changes in real-time -->
    <script>
        const mq = window.matchMedia('(prefers-color-scheme: dark)');
        if (mq.matches) document.documentElement.classList.add('dark');
        mq.addEventListener('change', e => document.documentElement.classList.toggle('dark', e.matches));
    </script>
    <main class="container">
        <!-- === Dashboard View ===
             Main monitoring interface showing:
             - Header with status pill and settings button
             - Audio input device selector
             - VU meter with real-time levels
             - Source status alerts
             - Output list with individual status indicators -->
        <div id="dashboard-view" x-show="view === 'dashboard'" x-transition:enter.duration.200ms>
            <header>
                <h1>ZuidWest FM Encoder</h1>
                <div class="header-controls">
                    <button class="icon-btn icon-btn--settings" id="settings-btn" type="button" title="Settings" @click="showSettings()">
                        <span x-html="icons.settings"></span>
                    </button>
                    <!-- Status pill - shows encoder state with animated indicator
                         States: running (green pulse), stopped (gray), connecting (yellow pulse), starting -->
                    <div id="status-pill" :class="statusPillClass">
                        <span id="status-dot" :class="{ 'animate-pulse': encoder.state === 'running' || encoder.state === 'starting' }"></span>
                        <span id="status-text" x-text="encoder.state.charAt(0).toUpperCase() + encoder.state.slice(1)"></span>
                    </div>
                </div>
            </header>

            <div class="upgrade-banner" id="upgrade-banner" x-show="version.updateAvail && version.latest" x-cloak>
            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
            </svg>
            <span>Update available: <strong x-text="version.latest"></strong></span>
            <a rel="noopener" href="https://github.com/oszuidwest/zwfm-encoder/releases" title="View release on GitHub" target="_blank">View release</a>
        </div>

        <section class="card">
            <div class="card-header brand">
                <h2>Audio Source</h2>
                <span class="badge">Input</span>
            </div>
            <div class="card-body">
                <div class="form-group">
                    <label for="audio-input">Input Device</label>
                    <select id="audio-input" x-model="settings.audioInput" @change="send('update_settings', null, { audio_input: settings.audioInput })">
                        <template x-if="devices.length === 0">
                            <option value="">No devices found</option>
                        </template>
                        <template x-for="device in devices" :key="device.id">
                            <option :value="device.id" x-text="device.name"></option>
                        </template>
                    </select>
                </div>

                <!-- === VU Meter Component ===
                     Real-time audio level visualization with:
                     - Mode toggle: Peak (default) vs RMS display
                     - Silence indicator: Activates when audio below threshold for configured duration
                     - Clip indicator: Flashes when levels exceed 0dB, held for 1.5s
                     - Two channels (L/R): Gradient bar with peak hold marker
                     - Scale: Reference marks at -60, -48, -24, -12, -6, 0 dB
                     Updates ~4 times per second -->
                <div id="vu-meter">
                    <div class="vu-header">
                        <button class="vu-mode-btn" id="vu-mode-toggle" type="button" @click="toggleVuMode()" x-text="vuMode === 'peak' ? 'Peak' : 'RMS'"></button>
                        <!-- Status indicators - visual feedback for audio state
                             TODO: Add aria-label for screen reader accessibility
                             Silence: Yellow dot when audio below threshold
                             Clip: Red flash when audio exceeds 0dB -->
                        <div class="vu-indicators">
                            <span class="vu-indicator" id="silence-alert"><span class="indicator-dot silence" :class="levels.silence_level"></span>Silence</span>
                            <span class="vu-indicator" id="clip-alert"><span class="indicator-dot clip" :class="{ active: clipActive }"></span>Clip</span>
                        </div>
                    </div>
                    <template x-for="ch in vuChannels" :key="ch.label">
                        <div class="vu-channel">
                            <span class="vu-label" x-text="ch.label"></span>
                            <div class="vu-track">
                                <div class="vu-gradient"></div>
                                <div class="vu-cover" :style="{ width: `${100 - dbToPercent(vuMode === 'peak' ? levels[ch.peak] : levels[ch.level])}%` }"></div>
                                <div class="vu-peak" :style="{ left: `${dbToPercent(levels[ch.peak])}%` }" :class="{ visible: dbToPercent(levels[ch.peak]) > 0 }"></div>
                            </div>
                            <span class="vu-db" x-text="`${(vuMode === 'peak' ? levels[ch.peak] : levels[ch.level]).toFixed(1)} dB`"></span>
                        </div>
                    </template>
                    <div class="vu-scale">
                        <span class="mark-60">-60</span>
                        <span class="mark-48">-48</span>
                        <span class="mark-24">-24</span>
                        <span class="mark-12">-12</span>
                        <span class="mark-6">-6</span>
                        <span class="mark-0">0</span>
                    </div>
                </div>

                <!-- Source status alert - shows when audio capture has issues
                     Conditions:
                     - No audio input device selected
                     - Source process not running
                     - Last error from source capture
                     Displays retry counter when encoder is attempting recovery -->
                <div class="alert-box" id="source-status" x-show="hasSourceIssue" x-cloak>
                    <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                    </svg>
                    <div>
                        <span x-text="encoder.sourceRetryCount > 0 ? `Retry ${encoder.sourceRetryCount}/${encoder.sourceMaxRetries}` : 'Error'"></span>
                        <p x-show="encoder.lastError" x-text="encoder.lastError"></p>
                    </div>
                </div>
            </div>
        </section>

        <!-- === Outputs List ===
             Displays configured stream outputs with real-time status.

             Each output shows:
             - Status dot (color-coded by state)
             - Host:port and stream ID
             - Status text (Connected, Connecting, Retry N/M, Failed)
             - Error message when in failed state
             - Delete button (disabled while deletion in progress)

             Status states:
             - Green: Connected and streaming
             - Yellow: Connecting or retrying
             - Red: Failed (shows error)
             - Gray: Encoder not running -->
        <section class="card">
            <div class="card-header slate">
                <h2>Outputs</h2>
                <div class="header-actions">
                    <span class="badge" x-text="outputs.length"></span>
                    <button class="btn-add" id="add-btn" type="button" @click="showAddOutput()">
                        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 5v14M5 12h14"/></svg>
                        Add
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div id="outputs-list">
                    <template x-for="output in outputs" :key="output.id">
                        <div class="output-item" :class="{ deleting: deletingOutputs[output.id] === output.created_at }">
                            <div class="output-row">
                                <span class="output-dot" :class="getOutputStateClass(output)"></span>
                                <span class="output-host" x-text="`${output.host}:${output.port}`"></span>
                                <button class="icon-btn icon-btn--delete" type="button" title="Delete"
                                        @click="deleteOutput(output.id)"
                                        :disabled="deletingOutputs[output.id] === output.created_at">
                                    <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M6 18L18 6M6 6l12 12"/></svg>
                                </button>
                            </div>
                            <div class="output-details">
                                <span class="output-codec" x-text="output.codec.toUpperCase()"></span>
                                <span class="output-streamid" x-text="`#${output.streamid}`"></span>
                                <span class="output-status" :class="getOutputStateClass(output)" x-text="getOutputStatusText(output)"></span>
                            </div>
                            <p class="output-error" x-show="shouldShowError(output)" x-text="outputStatuses[output.id]?.last_error"></p>
                        </div>
                    </template>
                </div>
            </div>
        </section>

            <footer>
                <div>
                    <a rel="noopener" href="https://github.com/oszuidwest/zwfm-encoder" title="View source on GitHub" target="_blank">
                        <svg fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z"/></svg>
                        GitHub
                    </a>
                    <span class="sep">|</span>
                    <span>Version <span id="version">{{VERSION}}</span></span>
                </div>
                <div class="copyright">© {{YEAR}} Streekomroep ZuidWest • MIT License</div>
            </footer>
        </div>

        <!-- === Settings View ===
             Configuration interface with tabbed navigation.

             Tabs: Audio | Alerts | About

             Cancel/Save workflow:
             - Cancel restores original values, Save persists all changes
             - Test Email disabled when unsaved changes exist
             - Settings not overwritten by status updates while editing -->
        <div id="settings-view" x-show="view === 'settings'" x-transition:enter.duration.200ms x-cloak>
            <header class="modal-nav">
                <button class="nav-btn" type="button" @click="cancelSettings()">Cancel</button>
                <h1>Settings</h1>
                <button class="nav-btn nav-btn--save" type="button" @click="saveSettings()" :disabled="!settingsDirty">Save</button>
            </header>

            <!-- Settings tab navigation - segmented control style
                 Tab switching is UI-only (no persistence)
                 Sliding indicator animates between tabs -->
            <nav class="settings-tabs">
                <template x-for="tab in settingsTabs" :key="tab.id">
                    <button class="settings-tab" type="button" @click="showTab(tab.id)" :class="{ active: settingsTab === tab.id }">
                        <span x-html="icons[tab.icon]"></span>
                        <span x-text="tab.label"></span>
                    </button>
                </template>
            </nav>

            <div class="settings-panels" id="settings-panels">
                <!-- Audio Panel - Silence detection configuration
                     - Threshold: dB level below which audio is considered silent (-60 to 0)
                     - Duration: Seconds of silence before triggering alerts (1-3600)
                     - Recovery: Seconds of audio before clearing silence state (1-60) -->
                <div class="settings-panel" id="panel-audio" x-show="settingsTab === 'audio'">
                    <div class="settings-section">
                        <div class="settings-section-header">
                            <span x-html="icons.audio"></span>
                            <h3>Silence Detection</h3>
                        </div>
                        <p class="settings-section-desc">Alert when audio drops below threshold for extended periods.</p>
                        <div class="form-group">
                            <label for="silence-threshold">Threshold</label>
                            <div class="input-with-unit">
                                <input id="silence-threshold" type="number" max="0" min="-60" step="1" x-model.number="settings.silenceThreshold" @input="markSettingsDirty()">
                                <span class="input-unit">dB</span>
                            </div>
                            <span class="input-hint">Audio below this level is considered silence</span>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="silence-duration">Alert after</label>
                                <div class="input-with-unit">
                                    <input id="silence-duration" type="number" max="300" min="1" step="1" x-model.number="settings.silenceDuration" @input="markSettingsDirty()">
                                    <span class="input-unit">sec</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="silence-recovery">Recover after</label>
                                <div class="input-with-unit">
                                    <input id="silence-recovery" type="number" max="60" min="1" step="1" x-model.number="settings.silenceRecovery" @input="markSettingsDirty()">
                                    <span class="input-unit">sec</span>
                                </div>
                            </div>
                        </div>
                        <span class="input-hint">Silence triggers alerts; recovery clears after audio returns</span>
                    </div>
                </div>

                <!-- Alerts Panel - Notification configuration for silence events
                     Three notification methods (can use multiple):
                     - Webhook: HTTP POST to URL on silence start/end
                     - File Log: Append JSON lines to local file
                     - Email: SMTP notifications with configurable server -->
                <div class="settings-panel" id="panel-alerts" x-show="settingsTab === 'alerts'">
                    <div class="settings-section">
                        <div class="settings-section-header">
                            <span x-html="icons.link"></span>
                            <h3>Webhook</h3>
                        </div>
                        <p class="settings-section-desc">POST request sent when silence is detected.</p>
                        <div class="form-group">
                            <label for="silence-webhook">Webhook URL</label>
                            <input id="silence-webhook" type="url" placeholder="https://hooks.example.com/..." x-model="settings.silenceWebhook" @input="markSettingsDirty()">
                        </div>
                    </div>
                    <div class="settings-section">
                        <div class="settings-section-header">
                            <span x-html="icons.file"></span>
                            <h3>File Log</h3>
                        </div>
                        <p class="settings-section-desc">Log silence events to a JSON Lines file.</p>
                        <div class="form-group">
                            <label for="silence-log-path">Log File Path</label>
                            <input id="silence-log-path" type="text" placeholder="/var/log/encoder/silence.jsonl" x-model="settings.silenceLogPath" @input="markSettingsDirty()">
                            <span class="input-hint">Leave empty to disable file logging</span>
                        </div>
                    </div>
                    <div class="settings-section">
                        <div class="settings-section-header">
                            <span x-html="icons.email"></span>
                            <h3>Email Alerts</h3>
                        </div>
                        <p class="settings-section-desc">Email notifications when silence is detected.</p>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="email-smtp-host">SMTP Server</label>
                                <input id="email-smtp-host" type="text" placeholder="smtp.example.com" x-model="settings.email.host" @input="markSettingsDirty()">
                            </div>
                            <div class="form-group">
                                <label for="email-smtp-port">Port</label>
                                <input id="email-smtp-port" type="number" max="65535" min="1" x-model.number="settings.email.port" @input="markSettingsDirty()">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="email-username">Username / From</label>
                            <input id="email-username" type="email" placeholder="alerts@example.com" x-model="settings.email.username" @input="markSettingsDirty()">
                        </div>
                        <div class="form-group">
                            <label for="email-password">Password</label>
                            <input id="email-password" type="password" placeholder="SMTP password" x-model="settings.email.password" @input="markSettingsDirty()">
                            <span class="input-hint">Leave empty to keep existing password</span>
                        </div>
                        <div class="form-group">
                            <label for="email-recipients">Recipients</label>
                            <input id="email-recipients" type="text" placeholder="admin@example.com, tech@example.com" x-model="settings.email.recipients" @input="markSettingsDirty()">
                            <span class="input-hint">Comma-separated email addresses</span>
                        </div>
                        <button class="btn secondary" id="email-test" type="button" @click="sendTestEmail()" :disabled="emailTestPending || settingsDirty" x-text="emailTestText">Send Test Email</button>
                    </div>
                </div>

                <!-- About Panel - Version info and attribution
                     Shows: Version, commit hash, build date, update availability
                     Includes: MIT license text, microphone logo SVG -->
                <div class="settings-panel" id="panel-about" x-show="settingsTab === 'about'">
                    <div class="settings-section about-section">
                        <div class="about-logo">
                            <!-- Microphone logo - custom SVG illustration
                                 Decorative branding element for About section
                                 Uses currentColor for theme-aware coloring -->
                            <svg class="app-logo" viewBox="0 0 512 512" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <!-- Microphone top -->
                                <path d="M369.8,148.3h-35.5c-2.8,0-5-2.2-5-5v-94c0-1.4,0.6-2.7,1.6-3.7l17.8-16.5c1.9-1.8,4.9-1.8,6.8,0l17.8,16.5c1,0.9,1.6,2.3,1.6,3.7v94C374.8,146,372.6,148.3,369.8,148.3z M339.3,138.3h25.5V51.4l-12.8-11.9l-12.8,11.9V138.3z"/>
                                <path d="M369.8,79h-35.5c-2.8,0-5-2.2-5-5s2.2-5,5-5h35.5c2.8,0,5,2.2,5,5S372.6,79,369.8,79z"/>
                                <!-- Cable -->
                                <path d="M291.8,484.3h-1.2c-36,0-65.3-29.3-65.3-65.3V241c0-30.5-24.8-55.3-55.3-55.3c-14.8,0-28.6,5.7-39.1,16.2c-10.4,10.4-16.2,24.3-16.2,39.1v238.3c0,2.8-2.2,5-5,5s-5-2.2-5-5V241c0-17.4,6.8-33.8,19.1-46.1c12.3-12.3,28.7-19.1,46.1-19.1c36,0,65.3,29.3,65.3,65.3v178c0,30.5,24.8,55.3,55.3,55.3h1.2c30.5,0,55.3-24.8,55.3-55.3v-79.3c0-2.8,2.2-5,5-5s5,2.2,5,5V419C357.1,455,327.8,484.3,291.8,484.3z"/>
                                <!-- Microphone body -->
                                <path d="M378.4,344.8h-52.6c-2.8,0-5-2.2-5-5v-42c0-2.8,2.2-5,5-5h52.6c2.8,0,5,2.2,5,5v42C383.4,342.5,381.1,344.8,378.4,344.8z M330.8,334.8h42.6v-32h-42.6V334.8z"/>
                                <path d="M378.4,303.5c-0.8,0-1.7-0.2-2.4-0.6c0,0-0.1,0-0.1-0.1h-47.5c0,0-0.1,0-0.1,0.1c-1.6,0.9-3.5,0.8-5.1-0.1c-16.3-10.1-26.1-27.6-26.1-46.8V143.3c0-2.8,2.2-5,5-5h100c2.8,0,5,2.2,5,5v112.7c0,19.2-9.7,36.7-26.1,46.8C380.2,303.2,379.3,303.5,378.4,303.5z M326.2,292.8h51.7c12-8.4,19.1-22,19.1-36.8V148.3h-90v107.7C307.1,270.7,314.2,284.3,326.2,292.8z"/>
                                <path d="M378.4,303.5c-0.8,0-1.7-0.2-2.4-0.6c0,0-0.1,0-0.1-0.1h-47.5c0,0-0.1,0-0.1,0.1c-1.6,0.9-3.5,0.8-5.1-0.1c-16.3-10.1-26.1-27.6-26.1-46.8v-63.2c0-2.8,2.2-5,5-5h100c2.8,0,5,2.2,5,5v63.2c0,19.2-9.7,36.7-26.1,46.8C380.2,303.2,379.3,303.5,378.4,303.5z M326.2,292.8h51.7c12-8.4,19.1-22,19.1-36.8v-58.2h-90v58.2C307.1,270.7,314.2,284.3,326.2,292.8z"/>
                            </svg>
                            <h2>ZuidWest FM Encoder</h2>
                        </div>
                        <div class="about-info">
                            <dl class="about-list">
                                <dt>Version</dt>
                                <dd id="about-version" x-text="`${version.current || 'dev'} (${(version.commit || 'unknown').slice(0, 7)})`">-</dd>
                                <dt>Built</dt>
                                <dd id="about-build" x-text="version.build_time || 'unknown'">-</dd>
                                <dt>Platform</dt>
                                <dd id="about-platform" x-text="settings.platform || '-'">-</dd>
                                <dt>Uptime</dt>
                                <dd id="about-uptime" x-text="encoder.uptime || '-'">-</dd>
                            </dl>
                        </div>
                        <div class="about-links">
                            <a rel="noopener" href="https://github.com/oszuidwest/zwfm-encoder" title="View source code on GitHub" target="_blank">
                                <svg fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z"/></svg>
                                GitHub
                            </a>
                            <a rel="noopener" href="https://github.com/oszuidwest/zwfm-encoder/issues" title="Report bugs or request features" target="_blank">
                                <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path d="M12 12.75c1.148 0 2.278.08 3.383.237 1.037.146 1.866.966 1.866 2.013 0 3.728-2.35 6.75-5.25 6.75S6.75 18.728 6.75 15c0-1.046.83-1.867 1.866-2.013A24.204 24.204 0 0112 12.75zm0 0c2.883 0 5.647.508 8.207 1.44a23.91 23.91 0 01-1.152 6.06M12 12.75c-2.883 0-5.647.508-8.208 1.44.125 2.104.52 4.136 1.153 6.06M12 12.75a2.25 2.25 0 002.248-2.354M12 12.75a2.25 2.25 0 01-2.248-2.354M12 8.25c.995 0 1.971-.08 2.922-.236.403-.066.74-.358.795-.762a3.778 3.778 0 00-.399-2.25M12 8.25c-.995 0-1.97-.08-2.922-.236-.402-.066-.74-.358-.795-.762a3.734 3.734 0 01.4-2.253M12 8.25a2.25 2.25 0 00-2.248 2.146M12 8.25a2.25 2.25 0 012.248 2.146M8.683 5a6.032 6.032 0 01-1.155-1.002c.07-.63.27-1.222.574-1.747m.581 2.749A3.75 3.75 0 0115.318 5m0 0c.427-.283.815-.62 1.155-.999a4.471 4.471 0 00-.575-1.752M4.921 6a24.048 24.048 0 00-.392 3.314c1.668.546 3.416.914 5.223 1.082M19.08 6c.205 1.08.337 2.187.392 3.314a23.882 23.882 0 01-5.223 1.082"/></svg>
                                Report Issue
                            </a>
                            <a rel="noopener" href="https://github.com/oszuidwest/zwfm-encoder/releases" title="View release history and downloads" target="_blank">
                                <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"/></svg>
                                Releases
                            </a>
                        </div>
                    </div>
                    <div class="settings-section">
                        <div class="settings-section-header">
                            <span x-html="icons.license"></span>
                            <h3>License</h3>
                        </div>
                        <div class="license-text">
                            <p><strong>MIT License</strong></p>
                            <p>Copyright (c) {{YEAR}} Streekomroep ZuidWest</p>
                            <p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
                            <p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
                            <p>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- === Add Output View ===
             Form for creating new stream outputs.

             Required fields: Host, Port
             Optional fields: Stream ID, Password, Codec, Max Retries

             Defaults: codec 'mp3', max retries 99 -->
        <div id="add-output-view" x-show="view === 'add-output'" x-transition:enter.duration.200ms x-cloak>
            <header class="modal-nav">
                <button class="nav-btn" type="button" @click="showDashboard()">Cancel</button>
                <h1>New Output</h1>
                <button class="nav-btn nav-btn--save" type="button" @click="submitNewOutput()" :disabled="!newOutput.host">Save</button>
            </header>

            <div class="settings-panels">
                <div class="settings-panel">
                    <div class="settings-section">
                        <div class="settings-section-header">
                            <span x-html="icons.server"></span>
                            <h3>Server Connection</h3>
                        </div>
                        <p class="settings-section-desc">Configure the SRT server to stream audio to.</p>
                        <div class="form-group">
                            <label for="new-host">Server</label>
                            <input id="new-host" type="text" placeholder="stream.example.com" x-model="newOutput.host">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="new-port">Port</label>
                                <input id="new-port" type="number" x-model.number="newOutput.port">
                            </div>
                            <div class="form-group">
                                <label for="new-streamid">Stream ID</label>
                                <input id="new-streamid" type="text" placeholder="studio" x-model="newOutput.streamid">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="new-password">Password</label>
                            <input id="new-password" type="password" placeholder="optional" x-model="newOutput.password">
                        </div>
                    </div>
                    <div class="settings-section">
                        <div class="settings-section-header">
                            <span x-html="icons.gear"></span>
                            <h3>Encoding</h3>
                        </div>
                        <p class="settings-section-desc">Audio encoding format and retry settings.</p>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="new-codec">Codec</label>
                                <select id="new-codec" x-model="newOutput.codec">
                                    <option value="mp3">MP3 (320 kbit/s)</option>
                                    <option value="mp2">MP2 (384 kbit/s)</option>
                                    <option value="ogg">OGG Vorbis (Q10)</option>
                                    <option value="wav">WAV (uncompressed)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="new-retries">Max Retries</label>
                                <input id="new-retries" type="number" max="9999" min="1" x-model.number="newOutput.max_retries">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="/icons.js"></script>
    <script src="/app.js"></script>
</body>
</html>
