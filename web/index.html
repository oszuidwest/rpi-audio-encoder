<!DOCTYPE html>
<html lang="en">
<!--
  ZuidWest FM Encoder - Web Interface

  Single-page application for real-time audio monitoring and encoder control.
  Built with Alpine.js for reactive state management.

  Views:
    - Dashboard: Live VU meter, encoder status, output management
    - Settings: Audio input, silence detection, notifications, about info
    - Add Output: Form for creating new stream outputs

  State Management:
    - Alpine.js component: encoderApp() defined in app.js
    - View switching via 'view' property: 'dashboard' | 'settings' | 'add-output'
    - WebSocket at /ws for real-time updates

  File Dependencies:
    - style.css: All styling and animations
    - icons.js: SVG icon definitions (window.icons)
    - app.js: Alpine.js application logic
    - alpine.js: Alpine.js framework

  @see app.js for state management and WebSocket handling
  @see style.css for component styling
  @see icons.js for SVG icon reference
-->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Web interface for Raspberry Pi audio encoder - stream audio to SRT servers">
    <title>ZuidWest FM Encoder</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="canonical" href="/">
    <link rel="stylesheet" href="/style.css">
    <script src="/alpine.min.js" defer="defer"></script>
</head>
<body x-data="encoderApp()">
    <!-- Dark mode detection - syncs with system preference
         Sets --color-scheme CSS variable for theme-aware styling
         Listens for system preference changes in real-time -->
    <script>
        const mq = window.matchMedia('(prefers-color-scheme: dark)');
        if (mq.matches) document.documentElement.classList.add('dark');
        mq.addEventListener('change', e => document.documentElement.classList.toggle('dark', e.matches));
    </script>

    <!-- Connection overlay - blocks UI when WebSocket disconnected -->
    <div class="connection-overlay" x-show="encoder.state === 'connecting'" x-cloak>
        <div class="connection-overlay__content">
            <div class="connection-overlay__spinner"></div>
            <span class="connection-overlay__text">Connecting...</span>
        </div>
    </div>

    <!-- Alert banner - page-wide header for silence/update notifications -->
    <div class="alert-banner"
         role="alert"
         aria-live="assertive"
         x-show="banner.visible"
         x-transition:enter.duration.200ms
         x-transition:leave.duration.150ms
         :class="'alert-banner--' + banner.type"
         x-cloak>
        <span class="alert-banner__message" x-text="banner.message"></span>
    </div>

    <main class="container">
        <noscript>
            <p class="noscript-message">This application requires JavaScript to function.</p>
        </noscript>

        <!-- === Dashboard View ===
             Main monitoring interface showing:
             - Header with settings and logout buttons
             - Audio input device selector
             - VU meter with real-time levels
             - Source status alerts
             - Output list with individual status indicators -->
        <div id="dashboard-view" x-show="view === 'dashboard'" x-transition:enter.duration.200ms x-cloak>
            <header class="header">
                <div class="header__brand">
                    <span class="header__logo" x-html="icons.appLogo"></span>
                    <h1 class="header__title">ZuidWest FM Encoder</h1>
                </div>
                <div class="header__actions">
                    <button class="icon-btn" type="button" tabindex="0" title="Settings" aria-label="Settings" @click="showSettings()">
                        <span x-html="icons.settings"></span>
                    </button>
                    <a class="icon-btn" href="/logout" tabindex="0" title="Sign out" aria-label="Sign out">
                        <span x-html="icons.logout"></span>
                    </a>
                </div>
            </header>

            <div class="banner" x-show="version.updateAvail && version.latest" x-cloak>
            <span class="icon-container" x-html="icons.cloud"></span>
            <span>Update available: <strong x-text="version.latest"></strong></span>
            <a rel="noopener" href="https://github.com/oszuidwest/zwfm-encoder/releases" title="View release on GitHub" target="_blank">View release</a>
        </div>

        <section class="card">
            <div class="card__header card__header--brand">
                <h2>Audio Source</h2>
                <span class="badge">Input</span>
            </div>
            <div class="card__body">
                <div class="form__group">
                    <label for="audio-input">Input Device</label>
                    <select id="audio-input" x-model="settings.audioInput" @change="send('update_settings', null, { audio_input: settings.audioInput })">
                        <template x-if="devices.length === 0">
                            <option value="">No devices found</option>
                        </template>
                        <template x-for="device in devices" :key="device.id">
                            <option :value="device.id" x-text="device.name"></option>
                        </template>
                    </select>
                </div>

                <!-- === VU Meter Component ===
                     Real-time audio level visualization with:
                     - Mode toggle: Peak (default) vs RMS display
                     - Silence indicator: Activates when audio below threshold for configured duration
                     - Clip indicator: Flashes when levels exceed 0dB, held for 1.5s
                     - Two channels (L/R): Gradient bar with peak hold marker
                     - Scale: Reference marks at -60, -48, -24, -12, -6, 0 dB
                     Updates ~4 times per second -->
                <div class="vu-meter">
                    <div class="vu__header">
                        <button class="vu__mode-btn" type="button" tabindex="0" @click="toggleVuMode()" x-text="vuMode === 'peak' ? 'Peak' : 'RMS'"></button>
                        <!-- Status indicators - visual feedback for audio state
                             Silence: Yellow dot when audio below threshold
                             Clip: Red flash when audio exceeds 0dB -->
                        <div class="vu__indicators">
                            <span class="vu__indicator" aria-label="Silence indicator"><span class="vu__indicator-dot" :class="getSilenceClass()"></span>Silence</span>
                            <span class="vu__indicator" aria-label="Clip indicator"><span class="vu__indicator-dot" :class="{ 'vu__indicator-dot--clip-active': clipActive }"></span>Clip</span>
                        </div>
                    </div>
                    <template x-for="ch in vuChannels" :key="ch.label">
                        <div class="vu__channel">
                            <span class="vu__label" x-text="ch.label"></span>
                            <div class="vu__track">
                                <div class="vu__gradient"></div>
                                <div class="vu__cover" :style="{ width: `${100 - dbToPercent(vuMode === 'peak' ? levels[ch.peak] : levels[ch.level])}%` }"></div>
                                <div class="vu__peak" :style="{ left: `${dbToPercent(levels[ch.peak])}%` }" :class="{ 'vu__peak--visible': dbToPercent(levels[ch.peak]) > 0 }"></div>
                            </div>
                            <span class="vu__db" x-text="`${(vuMode === 'peak' ? levels[ch.peak] : levels[ch.level]).toFixed(1)} dB`"></span>
                        </div>
                    </template>
                    <div class="vu__scale">
                        <span class="vu__mark--60">-60</span>
                        <span class="vu__mark--48">-48</span>
                        <span class="vu__mark--24">-24</span>
                        <span class="vu__mark--12">-12</span>
                        <span class="vu__mark--6">-6</span>
                        <span class="vu__mark--0">0</span>
                    </div>
                </div>

                <!-- Source status alert - shows when audio capture has issues
                     Conditions:
                     - No audio input device selected
                     - Source process not running
                     - Last error from source capture
                     Displays retry counter when encoder is attempting recovery -->
                <div class="alert" role="alert" x-show="hasSourceIssue" x-cloak>
                    <span class="icon-container" x-html="icons.warning"></span>
                    <div>
                        <span x-text="encoder.sourceRetryCount > 0 ? `Retry ${encoder.sourceRetryCount}/${encoder.sourceMaxRetries}` : 'Error'"></span>
                        <p x-show="encoder.lastError" x-text="encoder.lastError"></p>
                    </div>
                </div>
            </div>
        </section>

        <!-- === Outputs List ===
             Displays configured stream outputs with real-time status.

             Each output shows:
             - Status dot (color-coded by state)
             - Host:port and stream ID
             - Status text (Connected, Connecting, Retry N/M, Failed)
             - Error message when in failed state
             - Delete button (disabled while deletion in progress)

             Status states:
             - Green: Connected and streaming
             - Yellow: Connecting or retrying
             - Red: Failed (shows error)
             - Gray: Encoder not running -->
        <section class="card">
            <div class="card__header card__header--slate">
                <h2>Outputs</h2>
                <div class="card__actions">
                    <span class="badge" x-text="outputs.length"></span>
                    <button class="card__add-btn" type="button" tabindex="0" aria-label="Add output" @click="showAddOutput()">
                        <span class="icon-container" x-html="icons.plus"></span>
                        Add
                    </button>
                </div>
            </div>
            <div class="card__body">
                <div class="outputs-list">
                    <template x-for="output in outputs" :key="output.id">
                        <div class="list-item output__item" :class="{ 'output__item--deleting': deletingOutputs[output.id] === output.created_at }">
                            <div class="output__row" :data-output-id="output.id">
                                <span class="output__dot" :class="getOutputStateClass(output)"></span>
                                <span class="output__host" x-text="`${output.host}:${output.port}`"></span>
                                <button class="icon-btn icon-btn--delete" type="button" tabindex="0" title="Delete" aria-label="Delete output"
                                        @click="deleteOutput(output.id)"
                                        :disabled="deletingOutputs[output.id] === output.created_at">
                                    <span class="icon-container" x-html="icons.close"></span>
                                </button>
                            </div>
                            <div class="output__details">
                                <span class="output__codec" x-text="output.codec.toUpperCase()"></span>
                                <span class="output__streamid" x-text="`#${output.streamid}`"></span>
                                <span class="output__status" :class="getOutputStateClass(output)" x-text="getOutputStatusText(output)"></span>
                            </div>
                            <p class="output__error" x-show="shouldShowError(output)" x-text="outputStatuses[output.id]?.last_error"></p>
                        </div>
                    </template>
                </div>
            </div>
        </section>

            <footer class="footer">
                <div class="footer__links">
                    <a rel="noopener" href="https://github.com/oszuidwest/zwfm-encoder" title="View source on GitHub" target="_blank">
                        <span class="icon-container" x-html="icons.github"></span>
                        GitHub
                    </a>
                    <span class="footer__sep">|</span>
                    <span>Version <span class="footer__version">{{VERSION}}</span></span>
                </div>
                <div class="footer__copyright">© {{YEAR}} Streekomroep ZuidWest • MIT License</div>
            </footer>
        </div>

        <!-- === Settings View ===
             Configuration interface with tabbed navigation.

             Tabs: Audio | Notifications | About

             Cancel/Save workflow:
             - Cancel restores original values, Save persists all changes
             - Test buttons disabled when unsaved changes exist
             - Settings not overwritten by status updates while editing -->
        <div id="settings-view" class="settings-view" x-show="view === 'settings'" x-transition:enter.duration.200ms x-cloak>
            <header class="modal__nav">
                <button class="nav-btn" type="button" tabindex="0" @click="cancelSettings()">Cancel</button>
                <h1>Settings</h1>
                <button class="nav-btn nav-btn--save" type="button" tabindex="0" @click="saveSettings()" :disabled="!settingsDirty">Save</button>
            </header>

            <!-- Settings tab navigation - segmented control style
                 Tab switching is UI-only (no persistence)
                 Sliding indicator animates between tabs -->
            <div class="settings__tabs" role="tablist">
                <template x-for="tab in settingsTabs" :key="tab.id">
                    <button class="settings__tab" type="button" role="tab" :aria-selected="settingsTab === tab.id" :tabindex="settingsTab === tab.id ? 0 : -1" @click="showTab(tab.id)" :class="{ 'settings__tab--active': settingsTab === tab.id }">
                        <span x-html="icons[tab.icon]"></span>
                        <span x-text="tab.label"></span>
                    </button>
                </template>
            </div>

            <div class="settings__panels" id="settings-panels">
                <!-- Audio Panel - Silence detection configuration
                     - Threshold: dB level below which audio is considered silent (-60 to 0)
                     - Duration: Seconds of silence before triggering alerts (1-3600)
                     - Recovery: Seconds of audio before clearing silence state (1-60) -->
                <div class="settings__panel" role="tabpanel" id="panel-audio" x-show="settingsTab === 'audio'">
                    <div class="settings__section">
                        <div class="settings__section-header">
                            <span x-html="icons.audio"></span>
                            <h3>Silence Detection</h3>
                        </div>
                        <p class="settings__section-desc">Alert when audio drops below threshold for extended periods.</p>
                        <div class="form__group">
                            <label for="silence-threshold">Threshold</label>
                            <div class="input__group">
                                <input id="silence-threshold" type="number" max="0" min="-60" step="1" x-model.number="settings.silenceThreshold" @input="markSettingsDirty()">
                                <span class="input__unit">dB</span>
                            </div>
                            <span class="input__hint">Audio below this level is considered silence.</span>
                        </div>
                        <div class="form__row">
                            <div class="form__group">
                                <label for="silence-duration">Silence Duration</label>
                                <div class="input__group">
                                    <input id="silence-duration" type="number" max="300" min="1" step="1" x-model.number="settings.silenceDuration" @input="markSettingsDirty()">
                                    <span class="input__unit">sec</span>
                                </div>
                            </div>
                            <div class="form__group">
                                <label for="silence-recovery">Recovery Time</label>
                                <div class="input__group">
                                    <input id="silence-recovery" type="number" max="60" min="1" step="1" x-model.number="settings.silenceRecovery" @input="markSettingsDirty()">
                                    <span class="input__unit">sec</span>
                                </div>
                            </div>
                        </div>
                        <span class="input__hint">Silence triggers alerts. Recovery clears after audio returns.</span>
                    </div>
                </div>

                <!-- Notifications Panel - Notification configuration for silence events
                     Three notification methods (can use multiple):
                     - Webhook: HTTP POST to URL on silence start/end
                     - File Log: Append JSON lines to local file
                     - Email: SMTP notifications with configurable server -->
                <div class="settings__panel" role="tabpanel" id="panel-notifications" x-show="settingsTab === 'notifications'">
                    <div class="settings__section">
                        <div class="settings__section-header">
                            <span x-html="icons.link"></span>
                            <h3>Webhook</h3>
                        </div>
                        <p class="settings__section-desc">POST request sent when silence is detected.</p>
                        <div class="form__group">
                            <label for="silence-webhook">Webhook URL</label>
                            <input id="silence-webhook" type="url" placeholder="https://hooks.example.com/..." x-model="settings.silenceWebhook" @input="markSettingsDirty()">
                        </div>
                        <button class="btn btn--secondary btn--test" type="button" tabindex="0" @click="sendTest('webhook')" :disabled="testStates.webhook.pending || settingsDirty" x-text="testStates.webhook.text">Test</button>
                    </div>
                    <div class="settings__section">
                        <div class="settings__section-header">
                            <span x-html="icons.file"></span>
                            <h3>File Log</h3>
                        </div>
                        <p class="settings__section-desc">Log silence events to a JSON Lines file.</p>
                        <div class="form__group">
                            <label for="silence-log-path">Log File Path</label>
                            <input id="silence-log-path" type="text" placeholder="/var/log/encoder/silence.jsonl" x-model="settings.silenceLogPath" @input="markSettingsDirty()">
                            <span class="input__hint">Leave empty to disable file logging.</span>
                        </div>
                        <div class="btn-group">
                            <button class="btn btn--secondary btn--test" type="button" tabindex="0" @click="sendTest('log')" :disabled="testStates.log.pending || settingsDirty" x-text="testStates.log.text">Test</button>
                            <button class="btn btn--secondary btn--test" type="button" tabindex="0" @click="viewSilenceLog()" :disabled="!settings.silenceLogPath || settingsDirty">View Log</button>
                        </div>
                    </div>
                    <div class="settings__section">
                        <div class="settings__section-header">
                            <span x-html="icons.email"></span>
                            <h3>Email Notifications</h3>
                        </div>
                        <p class="settings__section-desc">Email notifications when silence is detected.</p>
                        <div class="form__row">
                            <div class="form__group">
                                <label for="email-smtp-host">SMTP Host</label>
                                <input id="email-smtp-host" type="text" placeholder="smtp.example.com" x-model="settings.email.host" @input="markSettingsDirty()">
                            </div>
                            <div class="form__group">
                                <label for="email-smtp-port">Port</label>
                                <input id="email-smtp-port" type="number" max="65535" min="1" x-model.number="settings.email.port" @input="markSettingsDirty()">
                            </div>
                        </div>
                        <div class="form__row">
                            <div class="form__group">
                                <label for="email-from-name">Sender Name</label>
                                <input id="email-from-name" type="text" placeholder="ZuidWest FM Encoder" x-model="settings.email.fromName" @input="markSettingsDirty()">
                            </div>
                            <div class="form__group">
                                <label for="email-username">Username</label>
                                <input id="email-username" type="email" placeholder="alerts@example.com" x-model="settings.email.username" @input="markSettingsDirty()">
                            </div>
                        </div>
                        <div class="form__group">
                            <label for="email-password">Password</label>
                            <input id="email-password" type="password" placeholder="SMTP password" x-model="settings.email.password" @input="markSettingsDirty()">
                            <span class="input__hint">Leave empty to keep existing password</span>
                        </div>
                        <div class="form__group">
                            <label for="email-recipients">Recipients</label>
                            <input id="email-recipients" type="text" placeholder="admin@example.com, tech@example.com" x-model="settings.email.recipients" @input="markSettingsDirty()">
                            <span class="input__hint">Comma-separated email addresses.</span>
                        </div>
                        <button class="btn btn--secondary btn--test" type="button" tabindex="0" @click="sendTest('email')" :disabled="testStates.email.pending || settingsDirty" x-text="testStates.email.text">Test</button>
                    </div>
                </div>

                <!-- About Panel - Version info and attribution
                     Shows: Version, commit hash, build date, update availability
                     Includes: MIT license text, audio plug logo SVG -->
                <div class="settings__panel" role="tabpanel" id="panel-about" x-show="settingsTab === 'about'">
                    <div class="settings__section about__section">
                        <div class="about__logo">
                            <span x-html="icons.appLogo"></span>
                            <h2>ZuidWest FM Encoder</h2>
                        </div>
                        <div class="about__info">
                            <dl class="about__list">
                                <dt>Version</dt>
                                <dd id="about-version" x-text="`${version.current || 'dev'} (${(version.commit || 'unknown').slice(0, 7)})`">-</dd>
                                <dt>Built</dt>
                                <dd id="about-build" x-text="version.build_time || 'unknown'">-</dd>
                                <dt>Platform</dt>
                                <dd id="about-platform" x-text="settings.platform || '-'">-</dd>
                                <dt>Uptime</dt>
                                <dd id="about-uptime" x-text="encoder.uptime || '-'">-</dd>
                            </dl>
                        </div>
                        <div class="about__links">
                            <a rel="noopener" href="https://github.com/oszuidwest/zwfm-encoder" title="View source code on GitHub" target="_blank">
                                <span class="icon-container" x-html="icons.github"></span>
                                GitHub
                            </a>
                            <a rel="noopener" href="https://github.com/oszuidwest/zwfm-encoder/issues" title="Report bugs or request features" target="_blank">
                                <span class="icon-container" x-html="icons.bug"></span>
                                Report Issue
                            </a>
                            <a rel="noopener" href="https://github.com/oszuidwest/zwfm-encoder/releases" title="View release history and downloads" target="_blank">
                                <span class="icon-container" x-html="icons.download"></span>
                                Releases
                            </a>
                        </div>
                    </div>
                    <div class="settings__section">
                        <div class="settings__section-header">
                            <span x-html="icons.license"></span>
                            <h3>License</h3>
                        </div>
                        <div class="about__text">
                            <p><strong>MIT License</strong></p>
                            <p>Copyright (c) {{YEAR}} Streekomroep ZuidWest</p>
                            <p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
                            <p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
                            <p>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>
                        </div>
                    </div>
                    <div class="settings__section">
                        <div class="settings__section-header">
                            <span x-html="icons.heart"></span>
                            <h3>Acknowledgements</h3>
                        </div>
                        <p class="settings__section-desc">This project is built with the following open source software:</p>
                        <div class="about__text">
                            <p><a href="https://alpinejs.dev" target="_blank" rel="noopener" title="Visit Alpine.js website"><strong>Alpine.js</strong></a> — MIT License<br>Lightweight JavaScript framework for reactive UI</p>
                            <p><a href="https://heroicons.com" target="_blank" rel="noopener" title="Visit Heroicons website"><strong>Heroicons</strong></a> — MIT License<br>Beautiful hand-crafted SVG icons by Tailwind Labs</p>
                            <p><a href="https://ffmpeg.org" target="_blank" rel="noopener" title="Visit FFmpeg website"><strong>FFmpeg</strong></a> — LGPL/GPL License<br>Audio encoding and SRT streaming</p>
                            <p><a href="https://github.com/gorilla/websocket" target="_blank" rel="noopener" title="View Gorilla WebSocket on GitHub"><strong>Gorilla WebSocket</strong></a> — BSD License<br>WebSocket implementation for Go</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- === Add Output View ===
             Form for creating new stream outputs.

             Required fields: Host, Port
             Optional fields: Stream ID, Password, Codec, Max Retries

             Defaults: codec 'mp3', max retries 99 -->
        <div id="add-output-view" x-show="view === 'add-output'" x-transition:enter.duration.200ms x-cloak>
            <header class="modal__nav">
                <button class="nav-btn" type="button" tabindex="0" @click="showDashboard()">Cancel</button>
                <h1>New Output</h1>
                <button class="nav-btn nav-btn--save" type="button" tabindex="0" @click="submitNewOutput()" :disabled="!newOutput.host">Save</button>
            </header>

            <div class="settings__panels">
                <div class="settings__panel">
                    <div class="settings__section">
                        <div class="settings__section-header">
                            <span x-html="icons.server"></span>
                            <h3>Server Connection</h3>
                        </div>
                        <p class="settings__section-desc">Configure the SRT server to stream audio to.</p>
                        <div class="form__group">
                            <label for="new-host">Host</label>
                            <input id="new-host" type="text" placeholder="stream.example.com" x-model="newOutput.host">
                        </div>
                        <div class="form__row">
                            <div class="form__group">
                                <label for="new-port">Port</label>
                                <input id="new-port" type="number" x-model.number="newOutput.port">
                            </div>
                            <div class="form__group">
                                <label for="new-streamid">Stream ID</label>
                                <input id="new-streamid" type="text" placeholder="studio" x-model="newOutput.streamid">
                            </div>
                        </div>
                        <div class="form__group">
                            <label for="new-password">Password</label>
                            <input id="new-password" type="password" placeholder="Optional" x-model="newOutput.password">
                        </div>
                    </div>
                    <div class="settings__section">
                        <div class="settings__section-header">
                            <span x-html="icons.settings"></span>
                            <h3>Encoding</h3>
                        </div>
                        <p class="settings__section-desc">Audio encoding format and retry settings.</p>
                        <div class="form__row">
                            <div class="form__group">
                                <label for="new-codec">Codec</label>
                                <select id="new-codec" x-model="newOutput.codec">
                                    <option value="mp3">MP3 (320 kbit/s)</option>
                                    <option value="mp2">MP2 (384 kbit/s)</option>
                                    <option value="ogg">Ogg Vorbis (~500 kbit/s)</option>
                                    <option value="wav">WAV (uncompressed)</option>
                                </select>
                            </div>
                            <div class="form__group">
                                <label for="new-retries">Max Retries</label>
                                <input id="new-retries" type="number" max="9999" min="1" x-model.number="newOutput.max_retries">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- === Silence Log Modal ===
             Broadcast console style log viewer displaying silence events.
             Dark theme with LED indicators and monospace data presentation. -->
        <div class="modal__overlay" x-show="silenceLogModal.visible" x-cloak @click.self="closeSilenceLog()" x-transition:enter.duration.200ms>
            <div class="modal__content" role="dialog" aria-modal="true" aria-labelledby="silence-log-title">
                <header class="modal__header">
                    <h2 id="silence-log-title">Silence Log</h2>
                    <button class="icon-btn icon-btn--close" type="button" tabindex="0" aria-label="Close" @click="closeSilenceLog()">
                        <span x-html="icons.close"></span>
                    </button>
                </header>
                <div class="modal__body">
                    <div class="empty-state log__loading" x-show="silenceLogModal.loading">
                        Loading events...
                    </div>
                    <div class="empty-state empty-state--error log__error" x-show="!silenceLogModal.loading && silenceLogModal.error">
                        <span x-html="icons.warning"></span>
                        <span x-text="silenceLogModal.error"></span>
                    </div>
                    <div class="empty-state log__empty" x-show="!silenceLogModal.loading && !silenceLogModal.error && silenceLogModal.entries.length === 0">
                        No events recorded
                    </div>
                    <div class="log__entries" x-show="!silenceLogModal.loading && !silenceLogModal.error && silenceLogModal.entries.length > 0">
                        <template x-for="entry in silenceLogModal.entries" :key="entry.timestamp">
                            <div class="list-item list-item--hover log__entry" :class="formatLogEntry(entry).eventClass">
                                <div class="log__entry-content">
                                    <span class="log__event" x-text="formatLogEntry(entry).event"></span>
                                    <div class="log__entry-details">
                                        <span>Threshold: <strong x-text="formatLogEntry(entry).threshold"></strong></span>
                                    </div>
                                </div>
                                <span class="log__time" x-text="formatLogEntry(entry).time"></span>
                            </div>
                        </template>
                    </div>
                </div>
                <footer class="modal__footer">
                    <span class="log__path" x-show="silenceLogModal.path" x-text="silenceLogModal.path"></span>
                    <button class="btn btn--secondary" type="button" tabindex="0" @click="refreshSilenceLog()" :disabled="silenceLogModal.loading">Refresh</button>
                </footer>
            </div>
        </div>
    </main>

    <script src="/icons.js"></script>
    <script src="/app.js"></script>
</body>
</html>
