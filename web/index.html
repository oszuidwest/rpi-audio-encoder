<!DOCTYPE html>
<html lang="en">
<!--
  ZuidWest FM Encoder - Web Interface

  Single-page application for real-time audio monitoring and encoder control.
  Built with Alpine.js for reactive state management.

  Views:
    - Dashboard: Live VU meter, encoder status, output management
    - Settings: Audio input, silence detection, alerts, about info
    - Add Output: Form for creating new stream outputs

  State Management:
    - Alpine.js component: encoderApp() defined in app.js
    - View switching via 'view' property: 'dashboard' | 'settings' | 'add-output'
    - WebSocket at /ws for real-time updates

  File Dependencies:
    - style.css: All styling and animations
    - icons.js: SVG icon definitions (window.icons)
    - app.js: Alpine.js application logic
    - alpine.js: Alpine.js framework

  @see app.js for state management and WebSocket handling
  @see style.css for component styling
  @see icons.js for SVG icon reference
-->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Web interface for Raspberry Pi audio encoder - stream audio to SRT servers">
    <title>ZuidWest FM Encoder</title>
    <link rel="canonical" href="/">
    <link rel="stylesheet" href="/style.css">
    <script src="/alpine.min.js" defer="defer"></script>
</head>
<body x-data="encoderApp()" x-cloak>
    <!-- Dark mode detection - syncs with system preference
         Sets --color-scheme CSS variable for theme-aware styling
         Listens for system preference changes in real-time -->
    <script>
        const mq = window.matchMedia('(prefers-color-scheme: dark)');
        if (mq.matches) document.documentElement.classList.add('dark');
        mq.addEventListener('change', e => document.documentElement.classList.toggle('dark', e.matches));
    </script>
    <main class="container">
        <!-- === Dashboard View ===
             Main monitoring interface showing:
             - Header with status pill and settings button
             - Audio input device selector
             - VU meter with real-time levels
             - Source status alerts
             - Output list with individual status indicators -->
        <div id="dashboard-view" x-show="view === 'dashboard'" x-transition:enter.duration.200ms>
            <header>
                <h1>ZuidWest FM Encoder</h1>
                <div class="header-controls">
                    <button class="icon-btn icon-btn--settings" id="settings-btn" type="button" title="Settings" @click="showSettings()">
                        <span x-html="icons.settings"></span>
                    </button>
                    <!-- Status pill - shows encoder state with animated indicator
                         States: running (green pulse), stopped (gray), connecting (yellow pulse), starting -->
                    <div id="status-pill" :class="statusPillClass">
                        <span id="status-dot" :class="{ 'animate-pulse': encoder.state === 'running' || encoder.state === 'starting' }"></span>
                        <span id="status-text" x-text="encoder.state.charAt(0).toUpperCase() + encoder.state.slice(1)"></span>
                    </div>
                </div>
            </header>

            <div class="upgrade-banner" id="upgrade-banner" x-show="version.updateAvail && version.latest" x-cloak>
            <span class="icon-container" x-html="icons.cloud"></span>
            <span>Update available: <strong x-text="version.latest"></strong></span>
            <a rel="noopener" href="https://github.com/oszuidwest/zwfm-encoder/releases" title="View release on GitHub" target="_blank">View release</a>
        </div>

        <section class="card">
            <div class="card-header card-header--brand">
                <h2>Audio Source</h2>
                <span class="badge">Input</span>
            </div>
            <div class="card-body">
                <div class="form-group">
                    <label for="audio-input">Input Device</label>
                    <select id="audio-input" x-model="settings.audioInput" @change="send('update_settings', null, { audio_input: settings.audioInput })">
                        <template x-if="devices.length === 0">
                            <option value="">No devices found</option>
                        </template>
                        <template x-for="device in devices" :key="device.id">
                            <option :value="device.id" x-text="device.name"></option>
                        </template>
                    </select>
                </div>

                <!-- === VU Meter Component ===
                     Real-time audio level visualization with:
                     - Mode toggle: Peak (default) vs RMS display
                     - Silence indicator: Activates when audio below threshold for configured duration
                     - Clip indicator: Flashes when levels exceed 0dB, held for 1.5s
                     - Two channels (L/R): Gradient bar with peak hold marker
                     - Scale: Reference marks at -60, -48, -24, -12, -6, 0 dB
                     Updates ~4 times per second -->
                <div id="vu-meter">
                    <div class="vu-header">
                        <button class="vu-mode-btn" id="vu-mode-toggle" type="button" @click="toggleVuMode()" x-text="vuMode === 'peak' ? 'Peak' : 'RMS'"></button>
                        <!-- Status indicators - visual feedback for audio state
                             TODO: Add aria-label for screen reader accessibility
                             Silence: Yellow dot when audio below threshold
                             Clip: Red flash when audio exceeds 0dB -->
                        <div class="vu-indicators">
                            <span class="vu-indicator" id="silence-alert"><span class="indicator-dot silence" :class="levels.silence_level"></span>Silence</span>
                            <span class="vu-indicator" id="clip-alert"><span class="indicator-dot clip" :class="{ active: clipActive }"></span>Clip</span>
                        </div>
                    </div>
                    <template x-for="ch in vuChannels" :key="ch.label">
                        <div class="vu-channel">
                            <span class="vu-label" x-text="ch.label"></span>
                            <div class="vu-track">
                                <div class="vu-gradient"></div>
                                <div class="vu-cover" :style="{ width: `${100 - dbToPercent(vuMode === 'peak' ? levels[ch.peak] : levels[ch.level])}%` }"></div>
                                <div class="vu-peak" :style="{ left: `${dbToPercent(levels[ch.peak])}%` }" :class="{ visible: dbToPercent(levels[ch.peak]) > 0 }"></div>
                            </div>
                            <span class="vu-db" x-text="`${(vuMode === 'peak' ? levels[ch.peak] : levels[ch.level]).toFixed(1)} dB`"></span>
                        </div>
                    </template>
                    <div class="vu-scale">
                        <span class="mark-60">-60</span>
                        <span class="mark-48">-48</span>
                        <span class="mark-24">-24</span>
                        <span class="mark-12">-12</span>
                        <span class="mark-6">-6</span>
                        <span class="mark-0">0</span>
                    </div>
                </div>

                <!-- Source status alert - shows when audio capture has issues
                     Conditions:
                     - No audio input device selected
                     - Source process not running
                     - Last error from source capture
                     Displays retry counter when encoder is attempting recovery -->
                <div class="alert-box" id="source-status" x-show="hasSourceIssue" x-cloak>
                    <span class="icon-container" x-html="icons.warning"></span>
                    <div>
                        <span x-text="encoder.sourceRetryCount > 0 ? `Retry ${encoder.sourceRetryCount}/${encoder.sourceMaxRetries}` : 'Error'"></span>
                        <p x-show="encoder.lastError" x-text="encoder.lastError"></p>
                    </div>
                </div>
            </div>
        </section>

        <!-- === Outputs List ===
             Displays configured stream outputs with real-time status.

             Each output shows:
             - Status dot (color-coded by state)
             - Host:port and stream ID
             - Status text (Connected, Connecting, Retry N/M, Failed)
             - Error message when in failed state
             - Delete button (disabled while deletion in progress)

             Status states:
             - Green: Connected and streaming
             - Yellow: Connecting or retrying
             - Red: Failed (shows error)
             - Gray: Encoder not running -->
        <section class="card">
            <div class="card-header card-header--slate">
                <h2>Outputs</h2>
                <div class="header-actions">
                    <span class="badge" x-text="outputs.length"></span>
                    <button class="btn-add" id="add-btn" type="button" @click="showAddOutput()">
                        <span class="icon-container" x-html="icons.plus"></span>
                        Add
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div id="outputs-list">
                    <template x-for="output in outputs" :key="output.id">
                        <div class="list-item output-item" :class="{ deleting: deletingOutputs[output.id] === output.created_at }">
                            <div class="output-row">
                                <span class="output-dot" :class="getOutputStateClass(output)"></span>
                                <span class="output-host" x-text="`${output.host}:${output.port}`"></span>
                                <button class="icon-btn icon-btn--delete" type="button" title="Delete"
                                        @click="deleteOutput(output.id)"
                                        :disabled="deletingOutputs[output.id] === output.created_at">
                                    <span class="icon-container" x-html="icons.close"></span>
                                </button>
                            </div>
                            <div class="output-details">
                                <span class="output-codec" x-text="output.codec.toUpperCase()"></span>
                                <span class="output-streamid" x-text="`#${output.streamid}`"></span>
                                <span class="output-status" :class="getOutputStateClass(output)" x-text="getOutputStatusText(output)"></span>
                            </div>
                            <p class="output-error" x-show="shouldShowError(output)" x-text="outputStatuses[output.id]?.last_error"></p>
                        </div>
                    </template>
                </div>
            </div>
        </section>

            <footer>
                <div>
                    <a rel="noopener" href="https://github.com/oszuidwest/zwfm-encoder" title="View source on GitHub" target="_blank">
                        <span class="icon-container" x-html="icons.github"></span>
                        GitHub
                    </a>
                    <span class="sep">|</span>
                    <span>Version <span id="version">{{VERSION}}</span></span>
                </div>
                <div class="copyright">© {{YEAR}} Streekomroep ZuidWest • MIT License</div>
            </footer>
        </div>

        <!-- === Settings View ===
             Configuration interface with tabbed navigation.

             Tabs: Audio | Alerts | About

             Cancel/Save workflow:
             - Cancel restores original values, Save persists all changes
             - Test buttons disabled when unsaved changes exist
             - Settings not overwritten by status updates while editing -->
        <div id="settings-view" x-show="view === 'settings'" x-transition:enter.duration.200ms x-cloak>
            <header class="modal-nav">
                <button class="nav-btn" type="button" @click="cancelSettings()">Cancel</button>
                <h1>Settings</h1>
                <button class="nav-btn nav-btn--save" type="button" @click="saveSettings()" :disabled="!settingsDirty">Save</button>
            </header>

            <!-- Settings tab navigation - segmented control style
                 Tab switching is UI-only (no persistence)
                 Sliding indicator animates between tabs -->
            <nav class="settings-tabs">
                <template x-for="tab in settingsTabs" :key="tab.id">
                    <button class="settings-tab" type="button" @click="showTab(tab.id)" :class="{ active: settingsTab === tab.id }">
                        <span x-html="icons[tab.icon]"></span>
                        <span x-text="tab.label"></span>
                    </button>
                </template>
            </nav>

            <div class="settings-panels" id="settings-panels">
                <!-- Audio Panel - Silence detection configuration
                     - Threshold: dB level below which audio is considered silent (-60 to 0)
                     - Duration: Seconds of silence before triggering alerts (1-3600)
                     - Recovery: Seconds of audio before clearing silence state (1-60) -->
                <div class="settings-panel" id="panel-audio" x-show="settingsTab === 'audio'">
                    <div class="settings-section">
                        <div class="settings-section-header">
                            <span x-html="icons.audio"></span>
                            <h3>Silence Detection</h3>
                        </div>
                        <p class="settings-section-desc">Alert when audio drops below threshold for extended periods.</p>
                        <div class="form-group">
                            <label for="silence-threshold">Threshold</label>
                            <div class="input-with-unit">
                                <input id="silence-threshold" type="number" max="0" min="-60" step="1" x-model.number="settings.silenceThreshold" @input="markSettingsDirty()">
                                <span class="input-unit">dB</span>
                            </div>
                            <span class="input-hint">Audio below this level is considered silence</span>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="silence-duration">Alert after</label>
                                <div class="input-with-unit">
                                    <input id="silence-duration" type="number" max="300" min="1" step="1" x-model.number="settings.silenceDuration" @input="markSettingsDirty()">
                                    <span class="input-unit">sec</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="silence-recovery">Recover after</label>
                                <div class="input-with-unit">
                                    <input id="silence-recovery" type="number" max="60" min="1" step="1" x-model.number="settings.silenceRecovery" @input="markSettingsDirty()">
                                    <span class="input-unit">sec</span>
                                </div>
                            </div>
                        </div>
                        <span class="input-hint">Silence triggers alerts; recovery clears after audio returns</span>
                    </div>
                </div>

                <!-- Alerts Panel - Notification configuration for silence events
                     Three notification methods (can use multiple):
                     - Webhook: HTTP POST to URL on silence start/end
                     - File Log: Append JSON lines to local file
                     - Email: SMTP notifications with configurable server -->
                <div class="settings-panel" id="panel-alerts" x-show="settingsTab === 'alerts'">
                    <div class="settings-section">
                        <div class="settings-section-header">
                            <span x-html="icons.link"></span>
                            <h3>Webhook</h3>
                        </div>
                        <p class="settings-section-desc">POST request sent when silence is detected.</p>
                        <div class="form-group">
                            <label for="silence-webhook">Webhook URL</label>
                            <input id="silence-webhook" type="url" placeholder="https://hooks.example.com/..." x-model="settings.silenceWebhook" @input="markSettingsDirty()">
                        </div>
                        <button class="btn btn--secondary btn-test" type="button" @click="sendTest('webhook')" :disabled="testStates.webhook.pending || settingsDirty" x-text="testStates.webhook.text">Test</button>
                    </div>
                    <div class="settings-section">
                        <div class="settings-section-header">
                            <span x-html="icons.file"></span>
                            <h3>File Log</h3>
                        </div>
                        <p class="settings-section-desc">Log silence events to a JSON Lines file.</p>
                        <div class="form-group">
                            <label for="silence-log-path">Log File Path</label>
                            <input id="silence-log-path" type="text" placeholder="/var/log/encoder/silence.jsonl" x-model="settings.silenceLogPath" @input="markSettingsDirty()">
                            <span class="input-hint">Leave empty to disable file logging</span>
                        </div>
                        <div class="btn-group">
                            <button class="btn btn--secondary btn-test" type="button" @click="sendTest('log')" :disabled="testStates.log.pending || settingsDirty" x-text="testStates.log.text">Test</button>
                            <button class="btn btn--secondary btn-test" type="button" @click="viewSilenceLog()" :disabled="!settings.silenceLogPath || settingsDirty">View Log</button>
                        </div>
                    </div>
                    <div class="settings-section">
                        <div class="settings-section-header">
                            <span x-html="icons.email"></span>
                            <h3>Email Alerts</h3>
                        </div>
                        <p class="settings-section-desc">Email notifications when silence is detected.</p>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="email-smtp-host">SMTP Server</label>
                                <input id="email-smtp-host" type="text" placeholder="smtp.example.com" x-model="settings.email.host" @input="markSettingsDirty()">
                            </div>
                            <div class="form-group">
                                <label for="email-smtp-port">Port</label>
                                <input id="email-smtp-port" type="number" max="65535" min="1" x-model.number="settings.email.port" @input="markSettingsDirty()">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="email-username">Username / From</label>
                            <input id="email-username" type="email" placeholder="alerts@example.com" x-model="settings.email.username" @input="markSettingsDirty()">
                        </div>
                        <div class="form-group">
                            <label for="email-password">Password</label>
                            <input id="email-password" type="password" placeholder="SMTP password" x-model="settings.email.password" @input="markSettingsDirty()">
                            <span class="input-hint">Leave empty to keep existing password</span>
                        </div>
                        <div class="form-group">
                            <label for="email-recipients">Recipients</label>
                            <input id="email-recipients" type="text" placeholder="admin@example.com, tech@example.com" x-model="settings.email.recipients" @input="markSettingsDirty()">
                            <span class="input-hint">Comma-separated email addresses</span>
                        </div>
                        <button class="btn btn--secondary btn-test" type="button" @click="sendTest('email')" :disabled="testStates.email.pending || settingsDirty" x-text="testStates.email.text">Test</button>
                    </div>
                </div>

                <!-- About Panel - Version info and attribution
                     Shows: Version, commit hash, build date, update availability
                     Includes: MIT license text, microphone logo SVG -->
                <div class="settings-panel" id="panel-about" x-show="settingsTab === 'about'">
                    <div class="settings-section about-section">
                        <div class="about-logo">
                            <!-- Microphone logo - custom SVG illustration
                                 Decorative branding element for About section
                                 Uses currentColor for theme-aware coloring -->
                            <svg class="app-logo" viewBox="0 0 512 512" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <!-- Microphone top -->
                                <path d="M369.8,148.3h-35.5c-2.8,0-5-2.2-5-5v-94c0-1.4,0.6-2.7,1.6-3.7l17.8-16.5c1.9-1.8,4.9-1.8,6.8,0l17.8,16.5c1,0.9,1.6,2.3,1.6,3.7v94C374.8,146,372.6,148.3,369.8,148.3z M339.3,138.3h25.5V51.4l-12.8-11.9l-12.8,11.9V138.3z"/>
                                <path d="M369.8,79h-35.5c-2.8,0-5-2.2-5-5s2.2-5,5-5h35.5c2.8,0,5,2.2,5,5S372.6,79,369.8,79z"/>
                                <!-- Cable -->
                                <path d="M291.8,484.3h-1.2c-36,0-65.3-29.3-65.3-65.3V241c0-30.5-24.8-55.3-55.3-55.3c-14.8,0-28.6,5.7-39.1,16.2c-10.4,10.4-16.2,24.3-16.2,39.1v238.3c0,2.8-2.2,5-5,5s-5-2.2-5-5V241c0-17.4,6.8-33.8,19.1-46.1c12.3-12.3,28.7-19.1,46.1-19.1c36,0,65.3,29.3,65.3,65.3v178c0,30.5,24.8,55.3,55.3,55.3h1.2c30.5,0,55.3-24.8,55.3-55.3v-79.3c0-2.8,2.2-5,5-5s5,2.2,5,5V419C357.1,455,327.8,484.3,291.8,484.3z"/>
                                <!-- Microphone body -->
                                <path d="M378.4,344.8h-52.6c-2.8,0-5-2.2-5-5v-42c0-2.8,2.2-5,5-5h52.6c2.8,0,5,2.2,5,5v42C383.4,342.5,381.1,344.8,378.4,344.8z M330.8,334.8h42.6v-32h-42.6V334.8z"/>
                                <path d="M378.4,303.5c-0.8,0-1.7-0.2-2.4-0.6c0,0-0.1,0-0.1-0.1h-47.5c0,0-0.1,0-0.1,0.1c-1.6,0.9-3.5,0.8-5.1-0.1c-16.3-10.1-26.1-27.6-26.1-46.8V143.3c0-2.8,2.2-5,5-5h100c2.8,0,5,2.2,5,5v112.7c0,19.2-9.7,36.7-26.1,46.8C380.2,303.2,379.3,303.5,378.4,303.5z M326.2,292.8h51.7c12-8.4,19.1-22,19.1-36.8V148.3h-90v107.7C307.1,270.7,314.2,284.3,326.2,292.8z"/>
                                <path d="M378.4,303.5c-0.8,0-1.7-0.2-2.4-0.6c0,0-0.1,0-0.1-0.1h-47.5c0,0-0.1,0-0.1,0.1c-1.6,0.9-3.5,0.8-5.1-0.1c-16.3-10.1-26.1-27.6-26.1-46.8v-63.2c0-2.8,2.2-5,5-5h100c2.8,0,5,2.2,5,5v63.2c0,19.2-9.7,36.7-26.1,46.8C380.2,303.2,379.3,303.5,378.4,303.5z M326.2,292.8h51.7c12-8.4,19.1-22,19.1-36.8v-58.2h-90v58.2C307.1,270.7,314.2,284.3,326.2,292.8z"/>
                            </svg>
                            <h2>ZuidWest FM Encoder</h2>
                        </div>
                        <div class="about-info">
                            <dl class="about-list">
                                <dt>Version</dt>
                                <dd id="about-version" x-text="`${version.current || 'dev'} (${(version.commit || 'unknown').slice(0, 7)})`">-</dd>
                                <dt>Built</dt>
                                <dd id="about-build" x-text="version.build_time || 'unknown'">-</dd>
                                <dt>Platform</dt>
                                <dd id="about-platform" x-text="settings.platform || '-'">-</dd>
                                <dt>Uptime</dt>
                                <dd id="about-uptime" x-text="encoder.uptime || '-'">-</dd>
                            </dl>
                        </div>
                        <div class="about-links">
                            <a rel="noopener" href="https://github.com/oszuidwest/zwfm-encoder" title="View source code on GitHub" target="_blank">
                                <span class="icon-container" x-html="icons.github"></span>
                                GitHub
                            </a>
                            <a rel="noopener" href="https://github.com/oszuidwest/zwfm-encoder/issues" title="Report bugs or request features" target="_blank">
                                <span class="icon-container" x-html="icons.bug"></span>
                                Report Issue
                            </a>
                            <a rel="noopener" href="https://github.com/oszuidwest/zwfm-encoder/releases" title="View release history and downloads" target="_blank">
                                <span class="icon-container" x-html="icons.download"></span>
                                Releases
                            </a>
                        </div>
                    </div>
                    <div class="settings-section">
                        <div class="settings-section-header">
                            <span x-html="icons.license"></span>
                            <h3>License</h3>
                        </div>
                        <div class="license-text">
                            <p><strong>MIT License</strong></p>
                            <p>Copyright (c) {{YEAR}} Streekomroep ZuidWest</p>
                            <p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
                            <p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
                            <p>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- === Add Output View ===
             Form for creating new stream outputs.

             Required fields: Host, Port
             Optional fields: Stream ID, Password, Codec, Max Retries

             Defaults: codec 'mp3', max retries 99 -->
        <div id="add-output-view" x-show="view === 'add-output'" x-transition:enter.duration.200ms x-cloak>
            <header class="modal-nav">
                <button class="nav-btn" type="button" @click="showDashboard()">Cancel</button>
                <h1>New Output</h1>
                <button class="nav-btn nav-btn--save" type="button" @click="submitNewOutput()" :disabled="!newOutput.host">Save</button>
            </header>

            <div class="settings-panels">
                <div class="settings-panel">
                    <div class="settings-section">
                        <div class="settings-section-header">
                            <span x-html="icons.server"></span>
                            <h3>Server Connection</h3>
                        </div>
                        <p class="settings-section-desc">Configure the SRT server to stream audio to.</p>
                        <div class="form-group">
                            <label for="new-host">Server</label>
                            <input id="new-host" type="text" placeholder="stream.example.com" x-model="newOutput.host">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="new-port">Port</label>
                                <input id="new-port" type="number" x-model.number="newOutput.port">
                            </div>
                            <div class="form-group">
                                <label for="new-streamid">Stream ID</label>
                                <input id="new-streamid" type="text" placeholder="studio" x-model="newOutput.streamid">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="new-password">Password</label>
                            <input id="new-password" type="password" placeholder="optional" x-model="newOutput.password">
                        </div>
                    </div>
                    <div class="settings-section">
                        <div class="settings-section-header">
                            <span x-html="icons.gear"></span>
                            <h3>Encoding</h3>
                        </div>
                        <p class="settings-section-desc">Audio encoding format and retry settings.</p>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="new-codec">Codec</label>
                                <select id="new-codec" x-model="newOutput.codec">
                                    <option value="mp3">MP3 (320 kbit/s)</option>
                                    <option value="mp2">MP2 (384 kbit/s)</option>
                                    <option value="ogg">OGG Vorbis (Q10)</option>
                                    <option value="wav">WAV (uncompressed)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="new-retries">Max Retries</label>
                                <input id="new-retries" type="number" max="9999" min="1" x-model.number="newOutput.max_retries">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- === Silence Log Modal ===
             Broadcast console style log viewer displaying silence events.
             Dark theme with LED indicators and monospace data presentation. -->
        <div class="modal-overlay" x-show="silenceLogModal.visible" x-cloak @click.self="closeSilenceLog()" x-transition:enter.duration.200ms>
            <div class="modal-content">
                <header class="modal-header">
                    <h2>Silence Log</h2>
                    <button class="icon-btn icon-btn--close" type="button" @click="closeSilenceLog()">
                        <span x-html="icons.close"></span>
                    </button>
                </header>
                <div class="modal-body">
                    <!-- Loading state -->
                    <div class="empty-state log-loading" x-show="silenceLogModal.loading">
                        Loading events...
                    </div>
                    <!-- Error state -->
                    <div class="empty-state empty-state--error log-error" x-show="!silenceLogModal.loading && silenceLogModal.error">
                        <span x-html="icons.warning"></span>
                        <span x-text="silenceLogModal.error"></span>
                    </div>
                    <!-- Empty state -->
                    <div class="empty-state log-empty" x-show="!silenceLogModal.loading && !silenceLogModal.error && silenceLogModal.entries.length === 0">
                        No events recorded
                    </div>
                    <!-- Log entries -->
                    <div class="log-entries" x-show="!silenceLogModal.loading && !silenceLogModal.error && silenceLogModal.entries.length > 0">
                        <template x-for="entry in silenceLogModal.entries" :key="entry.timestamp">
                            <div class="list-item list-item--hover log-entry" :class="formatLogEntry(entry).eventClass">
                                <div class="log-entry-content">
                                    <span class="log-event" x-text="formatLogEntry(entry).event"></span>
                                    <div class="log-entry-details">
                                        <span>Threshold: <strong x-text="formatLogEntry(entry).threshold"></strong></span>
                                    </div>
                                </div>
                                <span class="log-time" x-text="formatLogEntry(entry).time"></span>
                            </div>
                        </template>
                    </div>
                </div>
                <footer class="modal-footer">
                    <span class="log-path" x-show="silenceLogModal.path" x-text="silenceLogModal.path"></span>
                    <button class="btn btn--secondary" type="button" @click="refreshSilenceLog()" :disabled="silenceLogModal.loading">Refresh</button>
                </footer>
            </div>
        </div>
    </main>

    <script src="/icons.js"></script>
    <script src="/app.js"></script>
</body>
</html>
